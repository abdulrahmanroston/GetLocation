<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Location Selector</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>
  <div class="location-header">
    <span><i class="fa-solid fa-location-dot"></i> Delivery to: <span id="boxTitle">No location selected</span></span>
    <span class="toggle-arrow">▼</span>
  </div>

  <div id="locationModal" class="location-modal">
    <div class="location-modal-content">
      <div class="modal-header">
        <button id="closeModalBtn" class="close-btn"><i class="fa-solid fa-xmark"></i></button>
      </div>
      <div id="map" style="height: 300px; width: 100%; border-radius: 8px;"></div>
      <div class="modal-controls">
        <div class="buttons-loc">
          <button id="getLocationBtn">Get My Current Location</button>
          <button id="saveMapLocationBtn">Set Location from Map</button>
        </div>
        <div id="locationInput" style="display:none;">
          <input type="text" id="locationName" placeholder="Enter location name (e.g., Home)" style="width: 100%; padding: 8px; margin: 5px 0;">
          <input type="tel" id="phoneNumber" placeholder="Enter phone number" style="width: 100%; padding: 8px; margin: 5px 0;">
          <div id="locationPreview"></div>
          <button id="saveLocationBtn">Save Location</button>
        </div>
        <div id="locationList"></div>
      </div>
    </div>
  </div>

  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAFjkTsmVGgWlAhU2hKQSgeiFeKsEFYKBY&libraries=geometry&callback=initMap" async defer></script>

  <style>
    body {
      margin-top: 50px;
      font-family: Arial, sans-serif;
      background-color: #fff;
    }
    .location-header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      padding: 12px 20px;
      background-color: #000;
      border-bottom: 1px solid #000;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 600;
      color: #fff;
      z-index: 1000;
      cursor: pointer;
    }
    .location-header i {
      margin-right: 8px;
      color: #fff;
    }
    .toggle-arrow {
      font-size: 20px;
      transition: transform 0.3s ease;
      color: #fff;
      display: inline-block;
    }
    .toggle-arrow.open {
      transform: rotate(180deg);
    }
    .location-modal {
      position: fixed;
      bottom: -100%;
      left: 0;
      width: 100%;
      height: 80%;
      background-color: #fff;
      box-shadow: 0 -4px 15px rgba(0,0,0,0.2);
      transition: bottom 0.4s ease-in-out;
      z-index: 1001;
      overflow-y: auto;
    }
    .location-modal.open {
      bottom: 0;
    }
    .location-modal-content {
      padding: 15px 0;
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    .modal-header {
      text-align: right;
      padding: 0 15px;
    }
    .close-btn {
      background: none;
      border: none;
      font-size: 23px;
      cursor: pointer;
      color: #000;
      padding: 0;
      margin-bottom: 15px;
    }
    .close-btn:hover i {
      color: #ff0000;
    }
    .modal-controls {
      padding: 10px;
    }
    .buttons-loc {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    .modal-controls button {
      padding: 10px 15px;
      margin: 5px 0;
      background-color: #000;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    .modal-controls button:hover {
      background-color: #333;
    }
    #locationList {
      margin-top: 15px;
    }
    #locationList div {
      padding: 3px 5px;
      margin: 8px 0;
      background-color: #fff;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: background-color 0.2s ease;
    }
    #locationList > div {
      border: 1px solid #000;
      padding: 0 8px;
    }
    #locationList div:hover {
      background-color: #f0f0f0;
    }
    #locationList input[type="radio"] {
      margin-right: 10px;
    }
    #locationList label {
      font-size: 14px;
      color: #000;
    }
    #locationPreview {
      margin: 5px 0;
      font-size: 14px;
      color: #000;
    }
    .map-control-icon {
      background-color: #fff;
      border: 2px solid #000;
      border-radius: 50%;
      padding: 8px;
      font-size: 20px;
      color: #000;
      cursor: pointer;
      margin: 10px;
      transition: background-color 0.2s ease, color 0.2s ease;
    }
    .map-control-icon:hover {
      background-color: #000;
      color: #fff;
    }
    .delete-icon {
      cursor: pointer;
      color: #ff0000;
      margin-left: 10px;
      transition: color 0.2s ease;
    }
    .delete-icon:hover {
      color: #cc0000;
    }
  </style>

  <script>
    
    
    
       // Delivery zones data
  const deliveryZones = [
   
   {
  "name": "Zayed - October",
  "price": 100,
  "coordinates": [
    {"lat": 30.066281146560655, "lng": 30.847167077988757},
    {"lat": 30.02177247693524, "lng": 30.8463143246625},
    {"lat": 30.003891663415274, "lng": 30.8488929277936},
    {"lat": 29.98336017334924, "lng": 30.86344269538131},
    {"lat": 29.973088690616493, "lng": 30.87114839048587},
    {"lat": 29.971419871246354, "lng": 30.873345625307223},
    {"lat": 29.969189696367735, "lng": 30.87804529640067},
    {"lat": 29.966361175980552, "lng": 30.884709373889905},
    {"lat": 29.961795700258236, "lng": 30.890180485742917},
    {"lat": 29.956110898464004, "lng": 30.895240452841364},
    {"lat": 29.989035403705714, "lng": 30.856116369559857},
    {"lat": 29.957688120134648, "lng": 30.801456328808513},
    {"lat": 29.954664671461416, "lng": 30.79662482899002},
    {"lat": 29.89131179998209, "lng": 30.847771964122558},
    {"lat": 29.877633102152217, "lng": 30.859318466198488},
    {"lat": 29.833768339709493, "lng": 30.9018739911497},
    {"lat": 29.892006853306427, "lng": 31.00411187972489},
    {"lat": 29.892840376438755, "lng": 31.00525075706628},
    {"lat": 29.869201789107137, "lng": 31.054642191746012},
    {"lat": 29.868019216338027, "lng": 31.063976400401828},
    {"lat": 29.86637536549867, "lng": 31.07124644548321},
    {"lat": 29.925466347046253, "lng": 31.096177034558536},
    {"lat": 29.93772393757081, "lng": 31.097922425751904},
    {"lat": 29.94542960248424, "lng": 31.10199267598864},
    {"lat": 29.957644949987653, "lng": 31.107942278582925},
    {"lat": 29.96275509339948, "lng": 31.10861652724222},
    {"lat": 29.966784581895425, "lng": 31.108997152645657},
    {"lat": 29.970599195884702, "lng": 31.108717799477404},
    {"lat": 29.97327273408628, "lng": 31.10959166773614},
    {"lat": 29.97597318121747, "lng": 31.11178347340052},
    {"lat": 29.978359475748505, "lng": 31.1142843616515},
    {"lat": 29.978966432224738, "lng": 31.11525981520856},
    {"lat": 29.979741284628886, "lng": 31.116670122102818},
    {"lat": 29.980536367714123, "lng": 31.118048390174295},
    {"lat": 29.98159548538085, "lng": 31.120410525246342},
    {"lat": 29.987309448453416, "lng": 31.12786853346654},
    {"lat": 29.989669003957886, "lng": 31.127668879827922},
    {"lat": 29.991998991524113, "lng": 31.125853197356832},
    {"lat": 29.9937745837815, "lng": 31.12397993424932},
    {"lat": 29.99520304365811, "lng": 31.12225557270702},
    {"lat": 29.996915471059523, "lng": 31.1197995817962},
    {"lat": 29.998020505455173, "lng": 31.11779061722831},
    {"lat": 30.001213629204713, "lng": 31.113686022573148},
    {"lat": 30.00506737655519, "lng": 31.108672359441925},
    {"lat": 30.008109010463784, "lng": 31.10556552530403},
    {"lat": 30.011202615439245, "lng": 31.103601472310856},
    {"lat": 30.014070303340063, "lng": 31.10162343757719},
    {"lat": 30.020938407884387, "lng": 31.09784532887619},
    {"lat": 30.024274885976965, "lng": 31.096076196077405},
    {"lat": 30.02495689095379, "lng": 31.095045397552354},
    {"lat": 30.025258877246586, "lng": 31.094200401625272},
    {"lat": 30.025351416433054, "lng": 31.093181357618107},
    {"lat": 30.025528862795852, "lng": 31.092550018275944},
    {"lat": 30.025372550943857, "lng": 31.09174039708421},
    {"lat": 30.02543228055339, "lng": 31.08954105967888},
    {"lat": 30.02516938590277, "lng": 31.08748936593784},
    {"lat": 30.024291762446694, "lng": 31.08444571939856},
    {"lat": 30.023828235246654, "lng": 31.082213953953186},
    {"lat": 30.023060261649704, "lng": 31.077632857893633},
    {"lat": 30.022092241229004, "lng": 31.074437129916305},
    {"lat": 30.021980366478914, "lng": 31.07138116493033},
    {"lat": 30.02317474897582, "lng": 31.0688489686317},
    {"lat": 30.024143835037776, "lng": 31.066840810268445},
    {"lat": 30.02581258084605, "lng": 31.065289935009588},
    {"lat": 30.02762669061312, "lng": 31.063394210050376},
    {"lat": 30.03033975059796, "lng": 31.062251149566038},
    {"lat": 30.032779262799394, "lng": 31.061281497248444},
    {"lat": 30.039995384762562, "lng": 31.056953232931647},
    {"lat": 30.045441475888566, "lng": 31.05344551188253},
    {"lat": 30.051282397538642, "lng": 31.045432426427737},
    {"lat": 30.054826919495824, "lng": 31.039231551968555},
    {"lat": 30.060748833157618, "lng": 31.02922923639042},
    {"lat": 30.063930259290856, "lng": 31.024159430735978},
    {"lat": 30.082857517379338, "lng": 31.039741757396598},
    {"lat": 30.083328459543324, "lng": 31.039361965325185},
    {"lat": 30.08522908326016, "lng": 31.037633806660722},
    {"lat": 30.085827393314233, "lng": 31.037095326196436},
    {"lat": 30.09005835028178, "lng": 31.032696371278263},
    {"lat": 30.088779139666983, "lng": 31.02994713782914},
    {"lat": 30.089950029713705, "lng": 31.02889989565051},
    {"lat": 30.089238331495324, "lng": 31.027635202177805},
    {"lat": 30.08914870721364, "lng": 31.027494411167623},
    {"lat": 30.090221725805733, "lng": 31.026679041348842},
    {"lat": 30.09029746787165, "lng": 31.026606295021338},
    {"lat": 30.09032251926172, "lng": 31.026531940783286},
    {"lat": 30.090319688618465, "lng": 31.02644462337807},
    {"lat": 30.090283418412483, "lng": 31.02637057056836},
    {"lat": 30.090189174764703, "lng": 31.026289766291427},
    {"lat": 30.088449171412975, "lng": 31.025216669505994},
    {"lat": 30.087969763020553, "lng": 31.024957611021364},
    {"lat": 30.087632404335963, "lng": 31.024798186474868},
    {"lat": 30.087353414011858, "lng": 31.024669564081506},
    {"lat": 30.086926626004598, "lng": 31.02443537961983},
    {"lat": 30.086586392703722, "lng": 31.024266578052732},
    {"lat": 30.086143680260733, "lng": 31.024021375018805},
    {"lat": 30.087075290594356, "lng": 31.022318980332983},
    {"lat": 30.087632333048205, "lng": 31.021346076017778},
    {"lat": 30.08887761868513, "lng": 31.019163773881758},
    {"lat": 30.089021266994976, "lng": 31.018855662645535},
    {"lat": 30.089033997846443, "lng": 31.018728785470785},
    {"lat": 30.08899888562867, "lng": 31.01866534324259},
    {"lat": 30.08882261283368, "lng": 31.018533623802796},
    {"lat": 30.074131793314493, "lng": 31.007694978028695},
    {"lat": 30.081133728688073, "lng": 30.995513233759937},
    {"lat": 30.083475693066006, "lng": 30.991378106460132},
    {"lat": 30.084120323862365, "lng": 30.99000333752707},
    {"lat": 30.0844096260261, "lng": 30.98915213392783},
    {"lat": 30.0849753409544, "lng": 30.986863355282793},
    {"lat": 30.086741842561906, "lng": 30.979882580489118},
    {"lat": 30.087715987508773, "lng": 30.97634165364775},
    {"lat": 30.087956250159877, "lng": 30.97560990044792},
    {"lat": 30.08840479938266, "lng": 30.97417600862059},
    {"lat": 30.088713945808152, "lng": 30.972744430453588},
    {"lat": 30.088952203420703, "lng": 30.970910780584234},
    {"lat": 30.08894492481994, "lng": 30.969524696674398},
    {"lat": 30.088783925580103, "lng": 30.96820159217924},
    {"lat": 30.08852903374411, "lng": 30.966845310298936},
    {"lat": 30.08802946243047, "lng": 30.965314650479655},
    {"lat": 30.087108687956572, "lng": 30.96336866793814},
    {"lat": 30.086005646233914, "lng": 30.961720435864436},
    {"lat": 30.084592483341893, "lng": 30.959589403177375},
    {"lat": 30.082858930061732, "lng": 30.95694931642086},
    {"lat": 30.0776453192545, "lng": 30.94914591671082},
    {"lat": 30.075594260477317, "lng": 30.94588537375853},
    {"lat": 30.073858069194955, "lng": 30.943297665817482},
    {"lat": 30.07315159979086, "lng": 30.9412519628558},
    {"lat": 30.072989332077242, "lng": 30.939365735947945},
    {"lat": 30.073656465500733, "lng": 30.9347593737848},
    {"lat": 30.075520158302453, "lng": 30.9272448615514},
    {"lat": 30.075575011144153, "lng": 30.925538544490962},
    {"lat": 30.082147632378906, "lng": 30.896530150290005},
    {"lat": 30.086884587265075, "lng": 30.87733584447136},
    {"lat": 30.107709145499143, "lng": 30.84122315549982},
    {"lat": 30.066714471675795, "lng": 30.846930192597654},
    {"lat": 30.06628271119736, "lng": 30.847164269163386}
  ]
},

{
  "name": "Downtown",
  "price": 100,
  "coordinates": [
    { "lat": 30.0622361509258, "lng": 31.21592993321059 },
    { "lat": 30.048274676276776, "lng": 31.21913798073993 },
    { "lat": 30.046319393606453, "lng": 31.219703572281077 },
    { "lat": 30.042106829402343, "lng": 31.220890029749967 },
    { "lat": 30.041057518000656, "lng": 31.221291923870183 },
    { "lat": 30.040346892667287, "lng": 31.221589930007895 },
    { "lat": 30.03924479563163, "lng": 31.22188780298677 },
    { "lat": 30.038852212833945, "lng": 31.222194544588064 },
    { "lat": 30.038666445435652, "lng": 31.222632871887612 },
    { "lat": 30.03846535607549, "lng": 31.223180649538676 },
    { "lat": 30.038358109043855, "lng": 31.22337707624419 },
    { "lat": 30.038422260289167, "lng": 31.22345287123926 },
    { "lat": 30.03841263336939, "lng": 31.223549151398316 },
    { "lat": 30.03832953410418, "lng": 31.22357550915089 },
    { "lat": 30.038351871350926, "lng": 31.224673218330878 },
    { "lat": 30.039506338828758, "lng": 31.22623537692533 },
    { "lat": 30.042076135350754, "lng": 31.22729468292121 },
    { "lat": 30.043606137490315, "lng": 31.228116426234607 },
    { "lat": 30.0457566465617, "lng": 31.228418810188685 },
    { "lat": 30.047724917712586, "lng": 31.228397924874713 },
    { "lat": 30.049242385911526, "lng": 31.228089743720886 },
    { "lat": 30.05331782567663, "lng": 31.227359044565645 },
    { "lat": 30.055074413252242, "lng": 31.22655206638038 },
    { "lat": 30.0593424952029, "lng": 31.225212855759025 },
    { "lat": 30.05981883437866, "lng": 31.22512486405006 },
    { "lat": 30.061058316368303, "lng": 31.22466646165435 },
    { "lat": 30.06609733902036, "lng": 31.223463471499343 },
    { "lat": 30.069105418818154, "lng": 31.2226532678456 },
    { "lat": 30.072576028101793, "lng": 31.22254876475111 },
    { "lat": 30.072757373620874, "lng": 31.222472268777665 },
    { "lat": 30.07287659644132, "lng": 31.222337619961905 },
    { "lat": 30.07292097070669, "lng": 31.222171212115057 },
    { "lat": 30.072919248631948, "lng": 31.221975183995767 },
    { "lat": 30.072707377426198, "lng": 31.22160741515924 },
    { "lat": 30.071723950355207, "lng": 31.21976891159335 },
    { "lat": 30.06991968802619, "lng": 31.21782583040678 },
    { "lat": 30.066698058787907, "lng": 31.21537948876366 },
    { "lat": 30.066189853606602, "lng": 31.21529410430452 },
    { "lat": 30.06521822898884, "lng": 31.21535769732799 },
    { "lat": 30.064271115638377, "lng": 31.215529128992614 },
    { "lat": 30.06264441798551, "lng": 31.216093035527678 },
    { "lat": 30.061972073798742, "lng": 31.214608134092543 },
    { "lat": 30.061130270360948, "lng": 31.209116918105934 },
    { "lat": 30.06077867733093, "lng": 31.20666939829451 },
    { "lat": 30.06039148465443, "lng": 31.200501877256386 },
    { "lat": 30.060266285820447, "lng": 31.197606424533973 },
    { "lat": 30.059986815999764, "lng": 31.196274710701573 },
    { "lat": 30.059592025811966, "lng": 31.192648591280147 },
    { "lat": 30.05911944626537, "lng": 31.190062172386888 },
    { "lat": 30.043966269225706, "lng": 31.193541777007766 },
    { "lat": 30.041965387016205, "lng": 31.194037061842607 },
    { "lat": 30.035269958084683, "lng": 31.19802848174652 },
    { "lat": 30.038191565740306, "lng": 31.211407496778406 },
    { "lat": 30.039843910281846, "lng": 31.21890026544648 },
    { "lat": 30.039797645380602, "lng": 31.219662622541676 },
    { "lat": 30.04034452612018, "lng": 31.22002713414807 },
    { "lat": 30.061734613878528, "lng": 31.21457936398565 }
  ]
},

{
  "name": "Maadi",
  "price": 80,
  "coordinates": [
    {"lat": 29.967540574771405, "lng": 31.239606016509924},
    {"lat": 29.952030706319633, "lng": 31.256081692123274},
    {"lat": 29.94753829664225, "lng": 31.26601545681254},
    {"lat": 29.949381329269002, "lng": 31.268254973568702},
    {"lat": 29.950610111120298, "lng": 31.270463368270725},
    {"lat": 29.951823431472874, "lng": 31.2735724934939},
    {"lat": 29.955324935296275, "lng": 31.278381114719224},
    {"lat": 29.9571202308502, "lng": 31.28079650034813},
    {"lat": 29.958635182761384, "lng": 31.282674663939247},
    {"lat": 29.958895961032994, "lng": 31.287369992624917},
    {"lat": 29.963580142812077, "lng": 31.288384724933564},
    {"lat": 29.967263468828904, "lng": 31.287784120715457},
    {"lat": 29.973818755738236, "lng": 31.29003716132152},
    {"lat": 29.98606672890223, "lng": 31.288378528637537},
    {"lat": 29.988161234046686, "lng": 31.287593424929156},
    {"lat": 29.990032519317523, "lng": 31.28508868997156},
    {"lat": 29.991576388933225, "lng": 31.283586883196193},
    {"lat": 29.99016117516163, "lng": 31.27156934478711},
    {"lat": 29.988227043983443, "lng": 31.271970427064417},
    {"lat": 29.984027038172215, "lng": 31.274063650372426},
    {"lat": 29.98208876519861, "lng": 31.272213791960127},
    {"lat": 29.979218913801944, "lng": 31.27230414640593},
    {"lat": 29.977481738572124, "lng": 31.272023641678118},
    {"lat": 29.977264715517975, "lng": 31.270316675456115},
    {"lat": 29.973050855985377, "lng": 31.270784753648456},
    {"lat": 29.969183570040727, "lng": 31.26937308042696},
    {"lat": 29.970425983793348, "lng": 31.265998032641363},
    {"lat": 29.970953610824353, "lng": 31.263764069904596},
    {"lat": 29.971025562250034, "lng": 31.260169430255132},
    {"lat": 29.9709041081248, "lng": 31.260147083237314},
    {"lat": 29.970863180424317, "lng": 31.2593966745589},
    {"lat": 29.970288071690476, "lng": 31.259316655080056},
    {"lat": 29.969410336159726, "lng": 31.251475528003084},
    {"lat": 29.97405265549874, "lng": 31.247977198304397},
    {"lat": 29.96741581699756, "lng": 31.239189384839733},
    {"lat": 29.96755676455669, "lng": 31.239603147011792}
  ]
},


{
  "name": "Mokkatam",
  "price": 80,
  "coordinates": [
    { "lat": 30.017090319775193, "lng": 31.274529729887348 },
    { "lat": 30.017065381336437, "lng": 31.27445356318495 },
    { "lat": 30.016869565277815, "lng": 31.274043543743147 },
    { "lat": 30.00991625335901, "lng": 31.28217424465217 },
    { "lat": 30.006534603128102, "lng": 31.278943196264635 },
    { "lat": 30.003252516667985, "lng": 31.27971482101961 },
    { "lat": 29.992229685688883, "lng": 31.29236881916856 },
    { "lat": 29.987406072998454, "lng": 31.306376260751648 },
    { "lat": 29.984411339043007, "lng": 31.314899233192506 },
    { "lat": 29.983420962471683, "lng": 31.326937218495317 },
    { "lat": 30.014016050328067, "lng": 31.341530056557247 },
    { "lat": 30.0186026558503, "lng": 31.33380000570631 },
    { "lat": 30.025698987186487, "lng": 31.317830125825196 },
    { "lat": 30.027713004887573, "lng": 31.312154020995024 },
    { "lat": 30.027458776076443, "lng": 31.305402828530504 },
    { "lat": 30.02893525163897, "lng": 31.300710652028158 },
    { "lat": 30.02902447494189, "lng": 31.2942323922652 },
    { "lat": 30.0298534568671, "lng": 31.287423951582923 },
    { "lat": 30.029571040965266, "lng": 31.280763459556766 },
    { "lat": 30.028708570923783, "lng": 31.280680834737268 },
    { "lat": 30.01938212978102, "lng": 31.279474723637748 },
    { "lat": 30.017091365768763, "lng": 31.27452924310387 }
  ]
},

{
  "name": "Nasr City - Heliopolis",
  "price": 80,
  "coordinates": [
    {"lat": 30.086876048561805, "lng": 31.29931068859446},
    {"lat": 30.086624187766276, "lng": 31.306689881231165},
    {"lat": 30.080983214442313, "lng": 31.307190981256724},
    {"lat": 30.078482348439266, "lng": 31.300146970510866},
    {"lat": 30.073614273039013, "lng": 31.30215422126966},
    {"lat": 30.066579803831985, "lng": 31.305291584663138},
    {"lat": 30.063861123478432, "lng": 31.298345931159446},
    {"lat": 30.058432184620003, "lng": 31.302943302825327},
    {"lat": 30.054923779949704, "lng": 31.306846396882207},
    {"lat": 30.050201870863162, "lng": 31.307690471203102},
    {"lat": 30.05029761391532, "lng": 31.311674035662605},
    {"lat": 30.05017759175648, "lng": 31.307584783951796},
    {"lat": 30.043629321209394, "lng": 31.308600281923077},
    {"lat": 30.038967957067783, "lng": 31.307852686472103},
    {"lat": 30.037973263867656, "lng": 31.312180211609416},
    {"lat": 30.042557954232507, "lng": 31.323552761269326},
    {"lat": 30.034591431511274, "lng": 31.33153635884986},
    {"lat": 30.030670523668704, "lng": 31.337558537539962},
    {"lat": 30.024577159155456, "lng": 31.343551831732015},
    {"lat": 30.024121406944644, "lng": 31.346042315814856},
    {"lat": 30.015995464355726, "lng": 31.400992232606143},
    {"lat": 30.047582655917523, "lng": 31.40719060784332},
    {"lat": 30.05490798483362, "lng": 31.412332331406816},
    {"lat": 30.064745113480427, "lng": 31.42151469103328},
    {"lat": 30.07953425544798, "lng": 31.427204186982408},
    {"lat": 30.07919945576512, "lng": 31.435954444404217},
    {"lat": 30.081531667871175, "lng": 31.421109532402227},
    {"lat": 30.0801975591381, "lng": 31.407651090506675},
    {"lat": 30.080129070256632, "lng": 31.38928800525005},
    {"lat": 30.08862837218014, "lng": 31.384617294139133},
    {"lat": 30.08989749070382, "lng": 31.389717120034362},
    {"lat": 30.097341426283435, "lng": 31.384905308607046},
    {"lat": 30.10325852889501, "lng": 31.387640526526553},
    {"lat": 30.11082883459872, "lng": 31.38411102773017},
    {"lat": 30.118208102160665, "lng": 31.406693638539366},
    {"lat": 30.126913191199037, "lng": 31.403193197740137},
    {"lat": 30.123658232072017, "lng": 31.396909183313966},
    {"lat": 30.111562542222288, "lng": 31.371038450682533},
    {"lat": 30.110668590995843, "lng": 31.369688490945776},
    {"lat": 30.115722339675898, "lng": 31.366552789660147},
    {"lat": 30.128761244139938, "lng": 31.382004633326915},
    {"lat": 30.140422185682127, "lng": 31.400171555456126},
    {"lat": 30.1416198166269, "lng": 31.400896316345126},
    {"lat": 30.142043341485206, "lng": 31.400624260862088},
    {"lat": 30.139823936533432, "lng": 31.392254514020948},
    {"lat": 30.13817450531539, "lng": 31.38930406111345},
    {"lat": 30.13682456324183, "lng": 31.387424256220555},
    {"lat": 30.135197258285487, "lng": 31.38556344059836},
    {"lat": 30.12864752690143, "lng": 31.36698936858903},
    {"lat": 30.12815737423773, "lng": 31.36179424402357},
    {"lat": 30.12665815631202, "lng": 31.35351920025522},
    {"lat": 30.125770000475683, "lng": 31.350188756285974},
    {"lat": 30.121630816887148, "lng": 31.343187205531052},
    {"lat": 30.11148437839995, "lng": 31.330352757427193},
    {"lat": 30.095537198645502, "lng": 31.310779999094706},
    {"lat": 30.089718943576088, "lng": 31.303952889829958},
    {"lat": 30.08802632793683, "lng": 31.301368458716922},
    {"lat": 30.086878773170895, "lng": 31.29930211677464}
  ]
},


{
  "name": "Tagamo3",
  "price": 80,
  "coordinates": [
    {"lat": 30.079354844280687, "lng": 31.43560006433114},
    {"lat": 30.076799096438776, "lng": 31.434585941390736},
    {"lat": 30.07510976188196, "lng": 31.43347204023752},
    {"lat": 30.072648672786627, "lng": 31.431037447871432},
    {"lat": 30.06751314642335, "lng": 31.42552729815381},
    {"lat": 30.064636758628566, "lng": 31.420978433022213},
    {"lat": 30.061402399930202, "lng": 31.41784858184866},
    {"lat": 30.05507127462694, "lng": 31.41264163472769},
    {"lat": 30.0502555303745, "lng": 31.408356449771304},
    {"lat": 30.04638977441769, "lng": 31.40589586590056},
    {"lat": 30.038968938290864, "lng": 31.40420090886977},
    {"lat": 30.016370829120717, "lng": 31.400982520916727},
    {"lat": 30.00626507608409, "lng": 31.399397401668324},
    {"lat": 30.000524633167075, "lng": 31.39617407156382},
    {"lat": 29.995996322273356, "lng": 31.39075413027686},
    {"lat": 29.9919734917588, "lng": 31.380856714032547},
    {"lat": 29.98829979442489, "lng": 31.370959157433504},
    {"lat": 29.985536221711882, "lng": 31.367370073054047},
    {"lat": 29.97832457219225, "lng": 31.36110049114174},
    {"lat": 29.976923641526497, "lng": 31.362577943270594},
    {"lat": 29.976327808065918, "lng": 31.367555685437594},
    {"lat": 29.972129069402996, "lng": 31.376545191358986},
    {"lat": 29.972710487997645, "lng": 31.397464593515792},
    {"lat": 29.972142759437617, "lng": 31.4121339240327},
    {"lat": 29.972198901562734, "lng": 31.416916765157993},
    {"lat": 29.971627951150623, "lng": 31.42723520682472},
    {"lat": 29.972934867107767, "lng": 31.438483331268856},
    {"lat": 29.974558141744225, "lng": 31.44623012903287},
    {"lat": 29.97535223418906, "lng": 31.460578009539944},
    {"lat": 29.97026570357859, "lng": 31.469377968326484},
    {"lat": 29.951372247623894, "lng": 31.495864700616238},
    {"lat": 29.95905192338816, "lng": 31.501782645723637},
    {"lat": 29.97681784257746, "lng": 31.502630660620298},
    {"lat": 29.98000036774063, "lng": 31.516642500237452},
    {"lat": 29.973371398363952, "lng": 31.51855107631434},
    {"lat": 29.973543728489517, "lng": 31.542600825576017},
    {"lat": 29.968042322485502, "lng": 31.543298889099788},
    {"lat": 29.965070286075004, "lng": 31.54886685112217},
    {"lat": 29.993112218965067, "lng": 31.56946057058053},
    {"lat": 30.01310326734371, "lng": 31.585845323921774},
    {"lat": 30.02134791989002, "lng": 31.595374190785463},
    {"lat": 30.02819063096196, "lng": 31.59972979487742},
    {"lat": 30.038848141614082, "lng": 31.60351135799843},
    {"lat": 30.05402571110048, "lng": 31.61232421098873},
    {"lat": 30.074097153212307, "lng": 31.602124789740742},
    {"lat": 30.08081314497565, "lng": 31.598018690209443},
    {"lat": 30.084292752158547, "lng": 31.59084912793361},
    {"lat": 30.10308081859516, "lng": 31.586221326608722},
    {"lat": 30.099031324382707, "lng": 31.57117897454745},
    {"lat": 30.08482528078578, "lng": 31.53708460879625},
    {"lat": 30.084758379782855, "lng": 31.531314071846452},
    {"lat": 30.093550087383633, "lng": 31.49085454632828},
    {"lat": 30.094187805283468, "lng": 31.47904845521208},
    {"lat": 30.087541198158874, "lng": 31.4591954916977},
    {"lat": 30.081275661328476, "lng": 31.446790197379613},
    {"lat": 30.079350544574993, "lng": 31.435795951935717},
    {"lat": 30.079349392824568, "lng": 31.43559854659071}
  ]
},


{
  "name": "Madinaty",
  "price": 80,
  "coordinates": [
    {"lat": 30.102252513356547, "lng": 31.586563726265325},
    {"lat": 30.08649591778027, "lng": 31.589575605558537},
    {"lat": 30.084480333415655, "lng": 31.59042165829689},
    {"lat": 30.08349508673028, "lng": 31.59172283109922},
    {"lat": 30.082020531203, "lng": 31.59564584963556},
    {"lat": 30.080308459859253, "lng": 31.59926547018304},
    {"lat": 30.055445085466232, "lng": 31.611828523939636},
    {"lat": 30.055317661194138, "lng": 31.612885849158516},
    {"lat": 30.055468411787842, "lng": 31.613924322376278},
    {"lat": 30.056215429311024, "lng": 31.614741471632613},
    {"lat": 30.056481513386018, "lng": 31.61484294373426},
    {"lat": 30.066521515594417, "lng": 31.622372768118936},
    {"lat": 30.07216283220275, "lng": 31.627118592683843},
    {"lat": 30.07279199898538, "lng": 31.627842601161035},
    {"lat": 30.07313248354886, "lng": 31.631290542126493},
    {"lat": 30.072927425013262, "lng": 31.636283777745035},
    {"lat": 30.072926402228703, "lng": 31.6463850897033},
    {"lat": 30.073009842215257, "lng": 31.66743715831001},
    {"lat": 30.073923790038492, "lng": 31.67030060281681},
    {"lat": 30.07567235967531, "lng": 31.67203962369635},
    {"lat": 30.079310186342013, "lng": 31.674566303540843},
    {"lat": 30.079801063282588, "lng": 31.67676051378072},
    {"lat": 30.07994820767331, "lng": 31.68315282040402},
    {"lat": 30.081962182013555, "lng": 31.685420046863555},
    {"lat": 30.082121821752708, "lng": 31.686522814798877},
    {"lat": 30.101722594015655, "lng": 31.68715799872311},
    {"lat": 30.102506282031683, "lng": 31.67799898420361},
    {"lat": 30.103705704534676, "lng": 31.67616128885794},
    {"lat": 30.10925096828028, "lng": 31.67130810220968},
    {"lat": 30.107585516507726, "lng": 31.66958738161867},
    {"lat": 30.106192243141564, "lng": 31.667650061638852},
    {"lat": 30.10782059107457, "lng": 31.66050369832604},
    {"lat": 30.110619334659333, "lng": 31.643921967444186},
    {"lat": 30.11140388303066, "lng": 31.639794514275337},
    {"lat": 30.110630621469397, "lng": 31.6315204185251},
    {"lat": 30.114266984556224, "lng": 31.63069339957937},
    {"lat": 30.113407912599655, "lng": 31.625665449808253},
    {"lat": 30.111202244496724, "lng": 31.620663345692776},
    {"lat": 30.10857166370225, "lng": 31.612780954123423},
    {"lat": 30.105485483250717, "lng": 31.605652781625878},
    {"lat": 30.102382933072903, "lng": 31.58663695452117},
    {"lat": 30.102249472666017, "lng": 31.586557822314404}
  ]
},

{
  "name": "Shorouk City - Badr City",
  "price": 80,
  "coordinates": [
    {"lat": 30.178009329768557, "lng": 31.590461108812065},
    {"lat": 30.167174157286723, "lng": 31.59319734951032},
    {"lat": 30.159270749773782, "lng": 31.59100405243035},
    {"lat": 30.149834534829594, "lng": 31.58571927341771},
    {"lat": 30.14007941982959, "lng": 31.583323913240548},
    {"lat": 30.126752692504013, "lng": 31.5847533465533},
    {"lat": 30.127822983723874, "lng": 31.586688979543283},
    {"lat": 30.130048772860107, "lng": 31.602165397281624},
    {"lat": 30.106888092372813, "lng": 31.60774271060626},
    {"lat": 30.112438730847586, "lng": 31.62213810175365},
    {"lat": 30.114571123271546, "lng": 31.628572135488923},
    {"lat": 30.11696552417105, "lng": 31.64380475553176},
    {"lat": 30.116849375404087, "lng": 31.65174394429522},
    {"lat": 30.112701127679713, "lng": 31.663190326664306},
    {"lat": 30.109864920019945, "lng": 31.668951228337363},
    {"lat": 30.110900888607446, "lng": 31.70424441800003},
    {"lat": 30.10595604209965, "lng": 31.734285851183188},
    {"lat": 30.102443672172555, "lng": 31.76940274667743},
    {"lat": 30.099269408056387, "lng": 31.801572492076218},
    {"lat": 30.134393965373363, "lng": 31.806027615381794},
    {"lat": 30.144228528071935, "lng": 31.80829192847338},
    {"lat": 30.14978339008789, "lng": 31.804554614244438},
    {"lat": 30.158105038408607, "lng": 31.802608470765648},
    {"lat": 30.16440324067655, "lng": 31.797437411611014},
    {"lat": 30.168058168289292, "lng": 31.789244320258575},
    {"lat": 30.169749626339595, "lng": 31.77520556032374},
    {"lat": 30.16819942944211, "lng": 31.761334912124283},
    {"lat": 30.169507174685464, "lng": 31.747224574601148},
    {"lat": 30.16932622353464, "lng": 31.727943072644365},
    {"lat": 30.174363177622837, "lng": 31.705159200405973},
    {"lat": 30.176546251421996, "lng": 31.70479065974385},
    {"lat": 30.179545277322774, "lng": 31.681126632037007},
    {"lat": 30.18199481597935, "lng": 31.649400735728193},
    {"lat": 30.190193740319373, "lng": 31.648660632632925},
    {"lat": 30.18837976945109, "lng": 31.63866037820179},
    {"lat": 30.185802693327787, "lng": 31.625528372883508},
    {"lat": 30.178580944452833, "lng": 31.590693082418255},
    {"lat": 30.17799296091303, "lng": 31.590439053964133}
  ]
},


{
  "name": "Obour City",
  "price": 50,
  "coordinates": [
    { "lat": 30.17078147884267, "lng": 31.475934715336223 },
    { "lat": 30.164060541230057, "lng": 31.478714372920194 },
    { "lat": 30.166344027700063, "lng": 31.489830307885768 },
    { "lat": 30.16665124941403, "lng": 31.496576506683937 },
    { "lat": 30.171174417006895, "lng": 31.531473936101122 },
    { "lat": 30.155796045872805, "lng": 31.533886421749344 },
    { "lat": 30.162856784902658, "lng": 31.591539862069453 },
    { "lat": 30.180812262677563, "lng": 31.58915711094366 },
    { "lat": 30.19955384927026, "lng": 31.568428363803832 },
    { "lat": 30.212298173300468, "lng": 31.558630661111835 },
    { "lat": 30.253505753595505, "lng": 31.550788223081327 },
    { "lat": 30.27600952977673, "lng": 31.543107929806837 },
    { "lat": 30.282131714754016, "lng": 31.52767864510608 },
    { "lat": 30.278230244396724, "lng": 31.510863832800283 },
    { "lat": 30.27808689986165, "lng": 31.502004296998393 },
    { "lat": 30.27666931699008, "lng": 31.489934365605933 },
    { "lat": 30.262948827087627, "lng": 31.501998554541274 },
    { "lat": 30.274746350421466, "lng": 31.486502866419414 },
    { "lat": 30.263309952283137, "lng": 31.475161317379303 },
    { "lat": 30.258149639265113, "lng": 31.4695541752495 },
    { "lat": 30.25802701525285, "lng": 31.467652272851495 },
    { "lat": 30.24926165236367, "lng": 31.45810390403858 },
    { "lat": 30.251062493193075, "lng": 31.457121237864442 },
    { "lat": 30.248981772472604, "lng": 31.452064639050974 },
    { "lat": 30.23966669307366, "lng": 31.44343277439131 },
    { "lat": 30.233043225895557, "lng": 31.438332725535645 },
    { "lat": 30.230965112888143, "lng": 31.441796621868093 },
    { "lat": 30.22514196042694, "lng": 31.43925857898614 },
    { "lat": 30.20896472109554, "lng": 31.437961363875786 },
    { "lat": 30.208601899673297, "lng": 31.457586309651788 },
    { "lat": 30.200738198872827, "lng": 31.457823732306935 },
    { "lat": 30.196796994884963, "lng": 31.45999404902352 },
    { "lat": 30.184390183136827, "lng": 31.469238892946123 },
    { "lat": 30.170797780199308, "lng": 31.47594334887495 }
  ]
}
  
  ];
    
    
    
    
    
    
    
 // Global variables
    let map, marker;
    let currentCoords = null;
    let defaultPosition = { lat: 30.01626356681352, lng: 31.412277903747793 };
    let hasMovedPin = false;

    // Initialize Google Map with custom styles
    function initMap() {
      const mapStyles = [
        {
          "featureType": "all",
          "elementType": "geometry",
          "stylers": [
            { "visibility": "on" }
          ]
        },
        {
          "featureType": "all",
          "elementType": "labels",
          "stylers": [
            { "visibility": "on" }
          ]
        }
      ];

      map = new google.maps.Map(document.getElementById("map"), {
        center: defaultPosition,
        zoom: 11,
        styles: mapStyles,
        disableDefaultUI: true
      });

      marker = new google.maps.Marker({
        map: map,
        draggable: true,
        position: defaultPosition
      });

      map.addListener("click", (e) => {
        marker.setPosition(e.latLng);
        hasMovedPin = true;
      });
      marker.addListener("dragend", () => hasMovedPin = true);

    
      deliveryZones.forEach(zone => {
        const deliveryPolygon = new google.maps.Polygon({
          paths: zone.coordinates.map(coord => ({ lat: coord.lat, lng: coord.lng })), 
          strokeColor: "#000000", 
          strokeOpacity: 0.8,
          strokeWeight: 0,
          fillOpacity: 0,
          map: map
        });

      });

const outerBounds = [
  { lat: -17.5, lng: -15.0 }, // جنوب غرب
  { lat: -17.5, lng: 75.0 },  // جنوب شرق
  { lat: 72.5, lng: 75.0 },   // شمال شرق
  { lat: 72.5, lng: -15.0 }   // شمال غرب
];


      const paths = [outerBounds];
      
      
      deliveryZones.forEach(zone => {
      
        const reversedCoordinates = [...zone.coordinates].reverse();
        paths.push(reversedCoordinates);
      });

      // إنشاء المضلع الخارجي مع الثقوب
      const outerPolygon = new google.maps.Polygon({
        paths: paths,
        strokeColor: "#FF0000",
        strokeOpacity: 0,
        strokeWeight: 0.1,
        fillColor: "#ff8070",
        fillOpacity: 0.8, 
        map: map,
        zIndex: 1
      });

      addMapControls();
    }

    // Add custom map controls
    function addMapControls() {
      const locationIcon = document.createElement("button");
      locationIcon.innerHTML = '<i class="fa-solid fa-location-crosshairs"></i>';
      locationIcon.className = "map-control-icon";
      locationIcon.addEventListener("click", getCurrentPosition);
      map.controls[google.maps.ControlPosition.BOTTOM_RIGHT].push(locationIcon);
    }

    // Toggle modal visibility
    function toggleModal() {
      const modal = document.getElementById("locationModal");
      const toggleArrow = document.querySelector(".toggle-arrow");
      const locationPreview = document.getElementById("locationPreview");
      if (modal.classList.contains("open")) {
        modal.classList.remove("open");
        toggleArrow.classList.remove("open");
      } else {
        modal.classList.add("open");
        toggleArrow.classList.add("open");
        google.maps.event.trigger(map, "resize");
        map.setCenter(defaultPosition);
        locationPreview.innerHTML = "If your order is for a different location, use 'Set Location from Map'.";
      }
    }

    // Update header title
    function updateTitle() {
      const boxTitle = document.getElementById("boxTitle");
      const locations = JSON.parse(localStorage.getItem("userLocations")) || [];
      const selectedIndex = document.querySelector('input[name="selectedLocation"]:checked');
      boxTitle.textContent = selectedIndex && locations[selectedIndex.value] ? locations[selectedIndex.value].name : "No location selected";
    }

    // Get current position
    function getCurrentPosition() {
      if (navigator.geolocation) {
        const locationPreview = document.getElementById("locationPreview");
        locationPreview.innerHTML = "Fetching your current location...";
        navigator.geolocation.getCurrentPosition(
          (position) => {
            const pos = { lat: position.coords.latitude, lng: position.coords.longitude };
            marker.setPosition(pos);
            map.setCenter(pos);
            map.setZoom(15);
            hasMovedPin = true;
            setCurrentCoords(pos);
            showLocationInput(`Location set to your current position (${pos.lat}, ${pos.lng}).`);
          },
          (error) => {
            locationPreview.innerHTML = "Failed to get location. Please select manually from the map.";
            alert("Location access failed. Please select your location manually from the map.");
          },
          { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
        );
      }
    }

    // Set current coordinates
    function setCurrentCoords(position) {
      currentCoords = {
        link: `https://www.google.com/maps?q=${position.lat},${position.lng}`,
        timestamp: new Date().toLocaleString()
      };
    }

    // Show location input fields
    function showLocationInput(message) {
      const locationInput = document.getElementById("locationInput");
      const locationList = document.getElementById("locationList");
      const locationPreview = document.getElementById("locationPreview");
      locationPreview.innerHTML = message;
      locationInput.style.display = "block";
      locationList.style.display = "none";
    }

    // Check if location is within a delivery zone
    function checkDeliveryZone(lat, lng) {
      const position = new google.maps.LatLng(lat, lng);
      for (const zone of deliveryZones) {
        const polygon = new google.maps.Polygon({ paths: zone.coordinates.map(coord => ({ lat: coord.lat, lng: coord.lng })) });
        if (google.maps.geometry.poly.containsLocation(position, polygon)) {
          return { name: zone.name, price: zone.price };
        }
      }
      return null;
    }

    // Save location
    function saveLocation() {
      const name = document.getElementById("locationName").value.trim();
      const phone = document.getElementById("phoneNumber").value.trim();
      const locationPreview = document.getElementById("locationPreview");
      if (name && phone && currentCoords) {
        const lat = parseFloat(currentCoords.link.split("q=")[1].split(",")[0]);
        const lng = parseFloat(currentCoords.link.split("q=")[1].split(",")[1]);
        const zone = checkDeliveryZone(lat, lng);
        if (!zone) {
          locationPreview.innerHTML = "Sorry, delivery is not available to this location.";
          return;
        }
        currentCoords.name = name;
        currentCoords.phone = phone;
        currentCoords.deliveryPrice = zone.price;
        const locations = JSON.parse(localStorage.getItem("userLocations")) || [];
        locations.push(currentCoords);
        localStorage.setItem("userLocations", JSON.stringify(locations));
        addToCart(zone.price);
        displayLocations();
        const newIndex = locations.length - 1;
        setTimeout(() => {
          const newRadio = document.getElementById(`loc${newIndex}`);
          if (newRadio) {
            newRadio.checked = true;
            updateTitle();
          }
        }, 0);
        resetInputFields();
        toggleModal();
      } else {
        locationPreview.innerHTML = "Please enter both a location name and phone number.";
      }
    }

    // Add delivery price to cart
    function addToCart(deliveryPrice) {
      let cart = JSON.parse(localStorage.getItem("cart")) || { items: [], deliveryPrice: 0 };
      cart.deliveryPrice = deliveryPrice;
      localStorage.setItem("cart", JSON.stringify(cart));
      console.log(`Added delivery price ${deliveryPrice} EGP to cart.`);
    }

    // Display saved locations
    function displayLocations() {
      const locationList = document.getElementById("locationList");
      const locations = JSON.parse(localStorage.getItem("userLocations")) || [];
      locationList.innerHTML = "<h4>Saved Locations:</h4>";
      locations.forEach((loc, index) => {
        locationList.innerHTML += `
          <div>
            <div>
              <input type="radio" name="selectedLocation" value="${index}" id="loc${index}">
              <label for="loc${index}">${loc.name} - <a href="${loc.link}" target="_blank">View on Map</a> (Delivery: ${loc.deliveryPrice} EGP)</label>
            </div>
            <i class="fa-solid fa-trash delete-icon" data-index="${index}"></i>
          </div>`;
      });
      document.querySelectorAll('input[name="selectedLocation"]').forEach(radio => {
        radio.addEventListener("change", () => {
          updateTitle();
          const selectedIndex = document.querySelector('input[name="selectedLocation"]:checked').value;
          addToCart(locations[selectedIndex].deliveryPrice);
        });
      });
      document.querySelectorAll('.delete-icon').forEach(icon => {
        icon.addEventListener("click", (e) => {
          const index = e.target.getAttribute("data-index");
          deleteLocation(index);
        });
      });
    }

    // Delete a location
    function deleteLocation(index) {
      const locations = JSON.parse(localStorage.getItem("userLocations")) || [];
      if (locations.length > 0 && index >= 0 && index < locations.length) {
        locations.splice(index, 1);
        localStorage.setItem("userLocations", JSON.stringify(locations));
        displayLocations();
        updateTitle();
        if (locations.length === 0) {
          let cart = JSON.parse(localStorage.getItem("cart")) || { items: [], deliveryPrice: 0 };
          cart.deliveryPrice = 0;
          localStorage.setItem("cart", JSON.stringify(cart));
        }
      }
    }

    // Reset input fields
    function resetInputFields() {
      const locationInput = document.getElementById("locationInput");
      const locationList = document.getElementById("locationList");
      const locationNameInput = document.getElementById("locationName");
      const phoneNumberInput = document.getElementById("phoneNumber");
      const locationPreview = document.getElementById("locationPreview");
      locationInput.style.display = "none";
      locationList.style.display = "block";
      locationNameInput.value = "";
      phoneNumberInput.value = "";
      locationPreview.innerHTML = "";
    }

    // Validate checkout
    function validateCheckout(e) {
      const locations = JSON.parse(localStorage.getItem("userLocations")) || [];
      const selectedIndex = document.querySelector('input[name="selectedLocation"]:checked');
      if (!selectedIndex || locations.length === 0) {
        e.preventDefault();
        alert("Please add or select a delivery location before proceeding to checkout.");
        toggleModal();
        return false;
      }
      return true;
    }

    // Main logic
    if ("geolocation" in navigator) {
      const header = document.querySelector(".location-header");
      const closeModalBtn = document.getElementById("closeModalBtn");
      const getLocationBtn = document.getElementById("getLocationBtn");
      const saveLocationBtn = document.getElementById("saveLocationBtn");
      const saveMapLocationBtn = document.getElementById("saveMapLocationBtn");

      header.addEventListener("click", toggleModal);
      closeModalBtn.addEventListener("click", toggleModal);
      getLocationBtn.addEventListener("click", getCurrentPosition);
      saveLocationBtn.addEventListener("click", saveLocation);
      saveMapLocationBtn.addEventListener("click", () => {
        const position = marker.getPosition();
        if (!hasMovedPin) {
          document.getElementById("locationPreview").innerHTML = "Please move the pin to select a location on the map.";
        } else {
          setCurrentCoords({ lat: position.lat(), lng: position.lng() });
          showLocationInput(`Location: (${position.lat()}, ${position.lng()})`);
        }
      });

      document.addEventListener("DOMContentLoaded", () => {
        displayLocations();
        const locations = JSON.parse(localStorage.getItem("userLocations")) || [];
        if (locations.length === 0 || !document.querySelector('input[name="selectedLocation"]:checked')) {
          toggleModal();
        }

        const checkoutLinks = document.querySelectorAll('a[href="/checkout"], button[data-checkout]');
        checkoutLinks.forEach(link => link.addEventListener("click", validateCheckout));

        const checkoutForm = document.querySelector('form[action="/cart"]');
        if (checkoutForm) {
          checkoutForm.addEventListener("submit", (e) => {
            if (validateCheckout(e)) {
              const locations = JSON.parse(localStorage.getItem("userLocations")) || [];
              const selectedIndex = document.querySelector('input[name="selectedLocation"]:checked');
              const locationInput = document.createElement("input");
              locationInput.type = "hidden";
              locationInput.name = "attributes[SelectedLocation]";
              locationInput.value = JSON.stringify(locations[selectedIndex.value]);
              checkoutForm.appendChild(locationInput);
            }
          });
        }
      });
    } else {
      document.getElementById("locationList").innerHTML = "Browser does not support Geolocation.";
    }
  </script>
</body>
</html>
